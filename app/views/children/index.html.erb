<%= render "layouts/main-nav" %>

<div class="container py-5 dash-view">
  <%= render 'layouts/notice' %>
  
  <h1 class="font-weight-bold text-label mb-3  mt-4">Children in your area</h1>
  <p class="mb-5 text-muted">See signed up children in your area.</p>

  <div class="row">
    <% @children.each do |child| %>
      <div class="col-sm-9 col-md-6 col-lg-4">
        <div class="border shadow rounded pb-4 mb-4">
          <div class="bg-light mb-3 pt-4" style="height: 220px;">
            <% if child.image.attached? %>
              <%= image_tag child.image, style: "width: 150px; height: 150px; display: block; margin: 0 auto", class: "rounded-circle" %>
            <% else %>
              <div class="text-center pt-4" style="font-size: 7em;">🧒</div>
            <% end %>
          </div>
          <div class="text-muted text-center font-weight-bold text-label">
            <span class="text-truncate d-inline-block" style="max-width: 100px">
              <%= child.name.capitalize %>
            </span>
          </div>
          <div class="d-flex flex-wrap justify-content-center bg-light mx-4 my-2 border-top">
            <div class="my-2">
            <% if child.grade? %>
              <span class="">🎓</span> 
              <small><%= child.grade %></small>
            <% end %>
            </div>
          </div>

          <% if current_account %>
          <div class="text-center">
            <% unless conversation_exists?(current_account, child) %>
              <% if can_create_conversation?(current_account, child) %>
                <% if user_in_black_list?(current_account, child) %>
                  <p>This user is in your blacklist</p>
                  <%= button_to 'Remove from blacklist',
                    remove_from_blacklist_path(user: child, klass: child.class.name), class: 'btn btn-info' %>
                <% else %>
                  <div class="d-flex flex-wrap align-items-center justify-content-center">
                    <%= button_to 'Blacklist',
                      black_list_path(user: child, klass: child.class.name), class: 'btn btn-danger mr-2' %>
                    <%= form_for @conversation, url: :conversations do |form| %>
                      <%= fill_conversation_form(form, child) %>
                      <%= form.submit 'Start Conversation', class: 'btn btn-primary ml-2' %>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <% end %>
          
          <div class="text-center mt-3 mb-3">
            <% if current_admin %>
              <%= link_to 'View Profile', child, class: "btn bg-green-btn text-white px-3 shadow", style: "font-size: 0.9em" %>
              <%= link_to '<i class="fas fa-pen-alt ml-3"></i>'.html_safe, edit_child_path(child), class: "text-primary" %>
              <%= link_to '<i class="fas fa-trash ml-3"></i>'.html_safe, child, method: :delete, data: { confirm: 'Are you sure?' }, class: 'text-danger' %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>